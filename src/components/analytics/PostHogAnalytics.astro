---
interface Props {
  metric?: string; // Add optional metric prop to resolve potential type error
}

const { metric = '' } = Astro.props;
---
<!-- Load PostHog script directly to avoid import issues -->
<script type="module">
  try {
    // Import the necessary functions
    import { initPostHog, trackPageview as trackPostHogPageview } from '/lib/posthog.js';
    import { pageview as trackGooglePageview } from '/lib/gtag.js';
    import { reportWebVitals } from '/lib/analytics.js';

    // Import web-vitals from CDN
    import { onCLS, onFCP, onLCP, onTTFB, onINP } from 'https://unpkg.com/web-vitals@3.5.0/dist/web-vitals.attribution.js?module';

    // Initialize PostHog
    initPostHog();

    // Function to track pageviews in both analytics platforms
    const trackPageview = (url) => {
      try {
        // Track in PostHog
        trackPostHogPageview(url);
        
        // Track in Google Analytics
        trackGooglePageview(url);
      } catch (error) {
        console.error('Error tracking pageview:', error);
      }
    }

    // Track initial pageview
    trackPageview(window.location.pathname + window.location.search);

    // Set up navigation tracking for client-side navigation
    document.addEventListener('astro:page-load', () => {
      trackPageview(window.location.pathname + window.location.search);
    });

    // Report web vitals
    onCLS(reportWebVitals);
    onFCP(reportWebVitals);
    onLCP(reportWebVitals);
    onTTFB(reportWebVitals);
    onINP(reportWebVitals); // Replaced deprecated onFID with recommended onINP
  } catch (error) {
    console.error('Error in PostHogAnalytics:', error);
  }
</script>